name: Notify Develop

on:
  pull_request:
    branches:
      - develop
    types: [opened, closed]

jobs:
  notify-develop:
    runs-on: ubuntu-latest
    steps:
      - name: Extract PR data
        id: pr_data
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            core.setOutput("title", pr.title);
            core.setOutput("author", pr.user.login);
            core.setOutput("url", pr.html_url);


      - name: Notify Slack
        if: github.event.pull_request.merged == true
        uses: slackapi/slack-github-action@v1.25.0
        with:
          payload: |
            {
              "text": ":rocket: *Merge to Develop!*\nTitle: ${{ steps.pr_data.outputs.title }}\nAuthor: ${{ steps.pr_data.outputs.author }}\nURL: ${{ steps.pr_data.outputs.url }}"
            }
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}


      - name: Send email notification
        if: github.event.pull_request.merged == true
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.your-email.com
          server_port: 587
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "[Dev PR] ${{ github.event.pull_request.title }}"
          to: team@yourcompany.com
          body: |
            Pull Request Details:
            Title: ${{ github.event.pull_request.title }}
            Author: ${{ github.event.pull_request.user.login }}
            Merged By: ${{ github.event.pull_request.merged_by.login }}
            URL: ${{ github.event.pull_request.html_url }}

      - name: Notify Admins
        if: github.event.pull_request.merged == true
        run: |
          echo "Sending detailed report to admins..."
          # Aquí puedes usar otra llamada a Slack o email más detallada.
